---
title: "Data filtering and manipulation"
author: "Shelley, Sangay and AC"
date: "02/02/2022"
output:
  pdf_document: default
  html_document: default
---

*Objective:* Being able to subset Helen's data by including or excluding samples based on filters (e.g. list of characters, groupings, etc.)

*Description of script:* This is a two-step filtering processs for the downstream analysis with filtering process (1) based on the characters used and filtering process (2) based on the samples to include.

```{r setup, include=FALSE, echo=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(xlsx) #gives you access to the package contents
library(cluster) #for hierarchical clustering
library(vegan) # NMDS and other statistics
library(ggplot2)
library(tidyverse)
```

## Documentation of data filtering and manipulation for Helen's analysis

The analysis is based on two data files:
  `data/raw_data.csv`
  `data/column_metadata.csv`

The selection of characters for downstream analyses is based on the filtering of groups in the `data/column_metadata.csv` file.
Charaters are included in a group if marked with a yes (`Y`). Then these characters are pulled in the rawdata file based on the list of selected characters in the `data/column_metadata.csv`.

```{r rawdata}
dataset0<-read_csv("../data/raw_data.csv") %>%
  glimpse()
col_meta<-read_csv("../data/column_metadata.csv") %>%
  glimpse() #List column names to select character for downstream analysis
            #"group" names correspond to the set of characters selected for a specific analysis
            #(e.g. "group1" can correspond to NMDS analysis)
```

# Updating the rawdata and metadata with additional measured characters:

```{r}
### Rose's code ###
```



# Filtering of variables (characters) to use in analysis based on the column_metadata file:
Decides which columns (characters) to use

```{r}
include_columns<-filter(col_meta,Group1=="y")
include_columns$`Analysis Group`
dataset_columns <- select(dataset0,include_columns$`Analysis Group` ) %>%
  glimpse()
```

The ID column still contains some NAs so we drop those.
```{r}
dataset_columns$ID
dataset_final<-filter(dataset_columns,ID != "NA") %>%
  glimpse()
```

## Filtering the rows of data for specific OTUs (select which samples to use)

This is from the rawdata file.
Dataset Isla is filtering from the isla group column of the rawdata file.
Additional columns can be added to the rawdata file to create new groups in a similar way.

```{r}
datasetisla<-filter(dataset_final,Isla_group=="y")
dataset_Isla<-select(dataset_Isla,-Isla_group)
view(dataset_Isla)
```

